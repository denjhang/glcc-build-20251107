#VCPUv7

# ======== ('CODE', '_doscan_next', code0)
def code0():
	label('_doscan_next');
	_PROLOGUE(8,4,0x80); # save=R7
	LDW(R8);STW(R7);
	LDI(4);ADDW(R7);STW(R23);
	DEEK();ADDI(1);DOKE(R23);
	LDI(2);ADDW(R7);DEEKA(R8);
	CALLI('fgetc');
	DOKE(R7);
	
	label('.6');
	_EPILOGUE(8,4,0x80,saveAC=True);
# ======== ('CODE', 'spc', code1)
def code1():
	label('spc');
	_PROLOGUE(8,4,0x80); # save=R7
	MOVW(R8,R7);
	_BRA('.9');
	label('.8');
	MOVW(R7,R8);
	CALLI('_doscan_next');
	label('.9');
	DEEKV(R7);STW(R8);
	CALLI('isspace');
	_BNE('.8');
	label('.7');
	_EPILOGUE(8,4,0x80);
# ======== ('CODE', 'check_set', code2)
def code2():
	label('check_set');
	PUSH();
	LDI(0);STW(R19);
	STW(R18);
	INCV(R8);
	LDW(R8);
	PEEK();
	STW(R17);
	XORI(94);_BNE('.15');
	INCV(R8);
	LDW(R8);
	PEEK();STW(R17);
	MOVQW(1,R19);
	_BRA('.15');
	label('.14');
	LDW(R17);XORW(R9);_BNE('.17');
	MOVQW(1,R18);
	label('.17');
	INCV(R8);
	LDW(R8);
	PEEK();
	STW(R17);
	XORI(93);_BNE('.19');
	_BRA('.16');
	label('.19');
	label('.15');
	LDW(R17);_BNE('.14');
	label('.16');
	LDW(R9);_BEQ('.23');
	LDW(R18);XORW(R19);_BNE('.21');
	label('.23');
	LDW(R8);
	_BRA('.11');
	label('.21');
	LDI(0);
	label('.11');
	tryhop(2);POP();RET()
# ======== ('CODE', 'do_str', code3)
def code3():
	label('do_str');
	_PROLOGUE(20,6,0xfc); # save=R2-7
	MOVW(R8,R7);
	MOVW(R9,R6);
	MOVW(R10,R5);
	MOVW(R11,R4);
	MOVW(R12,R3);
	_BRA('.26');
	label('.25');
	LDW(R5);_BEQ('.31');
	LDW(R6);XORI(115);_BNE('.32');
	MOVW(R2,R8);
	CALLI('isspace');
	_BNE('.31');
	label('.32');
	LDW(R6);XORI(91);_BNE('.28');
	MOVW(R4,R8);
	MOVW(R2,R9);
	CALLI('check_set');
	_BEQ('.28');
	label('.31');
	_BRA('.27');
	label('.28');
	LDW(R3);_BEQ('.33');
	LDW(R2);POKE(R3);
	INCV(R3);
	label('.33');
	ADDSV(-1,R5);
	MOVW(R7,R8);
	CALLI('_doscan_next');
	label('.26');
	DEEKV(R7);
	STW(R2);
	_BGT('.25');
	label('.27');
	LDW(R6);XORI(99);_BEQ('.35');
	LDW(R3);POKEQ(0);
	label('.35');
	LDI(1);
	label('.24');
	_EPILOGUE(20,6,0xfc,saveAC=True);
# ======== ('CODE', 'do_lng', code4)
def code4():
	label('do_lng');
	_PROLOGUE(36,4,0xff); # save=R0-7
	MOVW(R8,R7);
	MOVW(R9,R6);
	MOVW(R10,R5);
	MOVW(R11,R4);
	_SP(-12+36);STW(R1);
	LDI(0);DOKE(R1);
	LDI(2);ADDW(R1);DOKEQ(0);
	LDW(R6);XORI(100);_BNE('.38');
	LDI(2);ADDW(R1);DOKEQ(10);
	_BRA('.39');
	label('.38');
	LDW(R6);XORI(120);_BNE('.40');
	LDI(2);ADDW(R1);DOKEQ(16);
	_BRA('.41');
	label('.40');
	LDW(R6);XORI(111);_BNE('.42');
	LDI(2);ADDW(R1);DOKEQ(8);
	label('.42');
	label('.41');
	label('.39');
	LDI(4);ADDW(R1);STW(T2);_MOVL('.44',[T2]);
	_BRA('.46');
	label('.45');
	MOVW(R7,R8);
	CALLI('_doscan_next');
	label('.46');
	MOVW(R1,R8);
	DEEKV(R7);STW(R9);
	CALLI('_strtol_push');
	_BNE('.45');
	_SP(-4+36);STW(R0);
	LDW(R5);ANDI(2);_BEQ('.48');
	MOVW(R4,R0);
	label('.48');
	LDW(R6);XORI(100);_BEQ('.55');
	LDW(R6);XORI(105);_BNE('.53');
	label('.55');
	LDI(1);_STLW(-14+36);
	_BRA('.54');
	label('.53');
	LDI(0);_STLW(-14+36);
	label('.54');
	_LDLW(-14+36);
	STW(R3);
	_BEQ('.50');
	MOVW(R1,R8);
	MOVW(R0,R9);
	CALLI('_strtol_decode_s');
	STW(R2);
	_BRA('.51');
	label('.50');
	MOVW(R1,R8);
	MOVW(R0,R9);
	CALLI('_strtol_decode_u');
	STW(R2);
	label('.51');
	LDW(R2);_BEQ('.56');
	LDW(R4);_BEQ('.56');
	LDW(R5);ANDI(2);_BNE('.56');
	_MOVL([SP,-4+36],L22);
	LDW(L22);DOKE(R4);
	LDW(R3);_BEQ('.61');
	_MOVL([SP,-4+36],L22);
	LDW(L22);_STLS(LAC);LDI(L22);_LCMPX();_BNE('.60');
	label('.61');
	LDW(R3);_BNE('.58');
	_MOVL([SP,-4+36],L22);
	LDW(L22);_STLU(LAC);LDI(L22);_LCMPX();_BEQ('.58');
	label('.60');
	LDWI('errno');DOKEQ(2);
	label('.58');
	label('.56');
	LDW(R2);
	label('.37');
	_EPILOGUE(36,4,0xff,saveAC=True);
# ======== ('CODE', 'parsespec', code5)
def code5():
	label('parsespec');
	PUSH();
	LDI(0);DOKE(R9);
	LDW(R10);DOKEQ(0);
	INCV(R8);
	LDW(R8);
	PEEK();STW(R19);
	XORI(42);_BNE('.66');
	DEEKV(R10);ORI(1);DOKE(R10);
	INCV(R8);
	LDW(R8);
	PEEK();STW(R19);
	_BRA('.66');
	label('.65');
	DEEKV(R10);ORI(8);DOKE(R10);
	DEEKV(R9);_MULI(10);ADDW(R19);SUBI(48);DOKE(R9);
	INCV(R8);
	LDW(R8);
	PEEK();STW(R19);
	label('.66');
	LDI(48);_CMPWS(R19);_BGT('.68');
	LDI(57);_CMPWS(R19);_BGE('.65');
	label('.68');
	LDW(R19);XORI(108);_BEQ('.72');
	LDW(R19);XORI(76);_BEQ('.72');
	LDW(R19);XORI(104);_BNE('.69');
	label('.72');
	LDW(R19);XORI(104);_BEQ('.73');
	DEEKV(R10);ORI(2);DOKE(R10);
	label('.73');
	INCV(R8);
	LDW(R8);
	PEEK();STW(R19);
	label('.69');
	DEEKV(R10);ANDI(8);_BNE('.75');
	LDW(R19);XORI(99);_BNE('.78');
	MOVQW(1,R18);
	_BRA('.79');
	label('.78');
	MOVIW(0xffff,R18);
	label('.79');
	LDW(R18);DOKE(R9);
	label('.75');
	LDW(R8);
	label('.62');
	tryhop(2);POP();RET()
# ======== ('CODE', '_doscan', code6)
def code6():
	label('_doscan');
	_PROLOGUE(40,12,0xfe); # save=R1-7
	MOVW(R8,R7);
	MOVW(R9,R6);
	MOVW(R10,R5);
	_SP(-12+40);STW(R4);
	STW(R8);
	MOVQW(0,R9);
	MOVQW(8,R10);
	CALLI('memset');
	LDW(R7);STXW(R4,2);
	STW(R8);
	CALLI('fgetc');
	DOKE(R4);
	_BRA('.84');
	label('.81');
	MOVW(R1,R8);
	CALLI('isspace');
	_BEQ('.85');
	MOVW(R4,R8);
	CALLI('spc');
	_BRA('.82');
	label('.85');
	LDW(R1);XORI(37);_BNE('.89');
	MOVW(R6,R23);
	LDW(R23);ADDI(1);STW(R22);
	PEEK();XORI(37);_BNE('.87');
	MOVW(R22,R6);
	LDW(R23);_BEQ('.87');
	label('.89');
	DEEKV(R4);XORW(R1);_BEQ('.90');
	_BRA('.83');
	label('.90');
	MOVW(R4,R8);
	CALLI('_doscan_next');
	_BRA('.82');
	label('.87');
	MOVW(R6,R8);
	_SP(-2+40);STW(R9);
	_SP(-4+40);STW(R10);
	CALLI('parsespec');
	STW(R6);
	PEEK();STW(R1);
	MOVQW(0,R3);
	_LDLW(-4+40);ANDI(1);_BNE('.92');
	MOVIW(0xfffe,R23);
	LDI(3);ADDW(R5);ANDW(R23);STW(R5);

	SUBI(-v(-2));DEEKA(R3);
	label('.92');
	LDW(R1);XORI(110);_BNE('.96');
	LDW(R3);_BEQ('.96');
	LDXW(R4,4);DOKE(R3);
	_BRA('.82');
	label('.96');
	LDW(R1);XORI(99);_BEQ('.98');
	LDW(R1);XORI(91);_BEQ('.98');
	MOVW(R4,R8);
	CALLI('spc');
	label('.98');
	LDI(4);ADDW(R4);DEEKA(R2);
	LDW(R1);XORI(91);_BEQ('.102');
	LDI(91);_CMPWS(R1);_BGT('.100');
	label('.107');
	LDI(99);_CMPWS(R1);_BGT('.100');
	LDI(120);_CMPWS(R1);_BLT('.100');
	LDWI(v('.108')-198);ADDW(R1);ADDW(R1);DEEK();CALL(vAC);
	label('.102');
	MOVW(R4,R8);
	MOVW(R1,R9);
	_LDLW(-2+40);STW(R10);
	MOVW(R6,R11);
	MOVW(R3,R12);
	CALLI('do_str');
	_STLW(-2+40);
	LDW(R1);XORI(91);_BNE('.101');
	MOVW(R6,R8);
	MOVQW(0,R9);
	CALLI('check_set');
	STW(R6);
	_BRA('.101');
	label('.105');
	MOVW(R4,R8);
	MOVW(R1,R9);
	_LDLW(-4+40);STW(R10);
	MOVW(R3,R11);
	CALLI('do_lng');
	_STLW(-2+40);
	_BRA('.101');
	label('.106');
	MOVW(R4,R8);
	MOVW(R3,R9);
	CALLI('_doscan_double');
	_STLW(-2+40);
	label('.100');
	label('.101');
	LDXW(R4,4);_CMPWS(R2);_BLE('.83');
	_LDLW(-2+40);_BEQ('.83');
	LDI(6);ADDW(R4);STW(R23);
	DEEK();ADDI(1);DOKE(R23);
	label('.82');
	INCV(R6);
	label('.84');
	PEEKV(R6);
	STW(R1);
	_BNE('.81');
	label('.83');
	DEEKV(R4);STW(R8);
	LDI(2);ADDW(R4);DEEKA(R9);
	CALLI('ungetc');
	LDXW(R4,6);
	label('.80');
	_EPILOGUE(40,12,0xfe,saveAC=True);
# ======== ('DATA', '.108', code7, 0, 2)
def code7():
	align(2);
	label('.108');
	words('.102');
	words('.105');
	words('.106');
	words('.106');
	words('.106');
	words('.100');
	words('.105');
	words('.100');
	words('.100');
	words('.100');
	words('.100');
	words('.100');
	words('.105');
	words('.105');
	words('.100');
	words('.100');
	words('.102');
	words('.100');
	words('.105');
	words('.100');
	words('.100');
	words('.105');
# ======== ('DATA', '.44', code8, 0, 4)
def code8():
	align(4);
	label('.44');
	words(0,0); # 0
# ======== (epilog)
code=[
	('EXPORT', '_doscan_next'),
	('CODE', '_doscan_next', code0),
	('CODE', 'spc', code1),
	('CODE', 'check_set', code2),
	('CODE', 'do_str', code3),
	('CODE', 'do_lng', code4),
	('EXPORT', 'parsespec'),
	('CODE', 'parsespec', code5),
	('EXPORT', '_doscan'),
	('CODE', '_doscan', code6),
	('DATA', '.108', code7, 0, 2),
	('IMPORT', '_doscan_double'),
	('IMPORT', 'ungetc'),
	('IMPORT', 'fgetc'),
	('IMPORT', '_strtol_decode_s'),
	('IMPORT', '_strtol_decode_u'),
	('IMPORT', '_strtol_push'),
	('IMPORT', 'errno'),
	('IMPORT', 'memset'),
	('IMPORT', 'isspace'),
	('DATA', '.44', code8, 0, 4) ]
module(code=code, name='../gigatron/libc/_doscan.c', cpu=7);

# Local Variables:
# mode: python
# indent-tabs-mode: t
# End:
