#VCPUv7

# ======== ('CODE', '_sflags', code0)
def code0():
	label('_sflags');
	PUSH();
	PEEKV(R8);STW(R17);
	XORI(114);_BEQ('.9');
	LDI(114);_CMPWS(R17);_BLT('.13');
	label('.12');
	LDW(R17);XORI(97);_BEQ('.11');
	_BRA('.6');
	label('.13');
	LDW(R17);XORI(119);_BEQ('.10');
	_BRA('.6');
	label('.9');
	MOVQW(1,R18);
	_BRA('.15');
	label('.10');
	MOVQW(2,R18);
	_BRA('.15');
	label('.11');
	MOVQW(10,R18);
	_BRA('.15');
	label('.6');
	LDI(0);
	_BRA('.5');
	label('.14');
	LDW(R19);XORI(43);_BEQ('.19');
	LDI(43);_CMPWS(R19);_BGT('.17');
	label('.21');
	LDW(R19);XORI(98);_BEQ('.18');
	_BRA('.17');
	label('.19');
	MOVQW(3,R18);
	_BRA('.18');
	label('.17');
	LDI(0);
	_BRA('.5');
	label('.18');
	label('.15');
	INCV(R8);
	LDW(R8);
	PEEK();
	STW(R19);
	_BNE('.14');
	LDW(R18);
	label('.5');
	tryhop(2);POP();RET()
# ======== ('CODE', 'freopen', code1)
def code1():
	label('freopen');
	_PROLOGUE(16,6,0xf0); # save=R4-7
	MOVW(R8,R7);
	MOVW(R9,R6);
	MOVW(R10,R5);
	MOVW(R6,R8);
	CALLI('_sflags');
	STW(R4);
	_BNE('.23');
	LDWI('errno');DOKEQ(3);
	LDI(0);
	_BRA('.22');
	label('.23');
	MOVW(R5,R8);
	CALLI('_sclose');
	LDW(R4);POKE(R5);
	MOVW(R5,R8);
	MOVW(R7,R9);
	CALLI('_openf');
	_BLT('.25');
	PEEKV(R5);ANDI(243);POKE(R5);
	LDW(R5);
	_BRA('.22');
	label('.25');
	LDW(R5);POKEQ(0);
	LDI(0);
	label('.22');
	_EPILOGUE(16,6,0xf0,saveAC=True);
# ======== ('CODE', 'fopen', code2)
def code2():
	label('fopen');
	_PROLOGUE(16,8,0xe0); # save=R5-7
	MOVW(R8,R7);
	MOVW(R9,R6);
	CALLI('_sfindiob');
	STW(R5);
	_BEQ('.28');
	MOVW(R7,R8);
	MOVW(R6,R9);
	MOVW(R5,R10);
	CALLI('freopen');
	
	_BRA('.27');
	label('.28');
	LDWI('errno');DOKEQ(6);
	LDI(0);
	label('.27');
	_EPILOGUE(16,8,0xe0,saveAC=True);
# ======== (epilog)
code=[
	('CODE', '_sflags', code0),
	('EXPORT', 'freopen'),
	('CODE', 'freopen', code1),
	('EXPORT', 'fopen'),
	('CODE', 'fopen', code2),
	('IMPORT', '_sfindiob'),
	('IMPORT', '_sclose'),
	('IMPORT', '_openf'),
	('IMPORT', 'errno') ]
module(code=code, name='../gigatron/libc/fopen.c', cpu=7);

# Local Variables:
# mode: python
# indent-tabs-mode: t
# End:
