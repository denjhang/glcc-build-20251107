#VCPUv7

# ======== ('CODE', '_schkseek', code0)
def code0():
	label('_schkseek');
	PUSH();
	PEEKV(R8);
	STW(R19);
	_BNE('.6');
	LDWI('errno');DOKEQ(3);
	LDI(3);
	_BRA('.5');
	label('.6');
	LDXW(R8,2);ADDI(6);DEEK();_BNE('.8');
	LDWI('errno');DOKEQ(10);
	LDI(10);
	_BRA('.5');
	label('.8');
	LDI(0);
	label('.5');
	tryhop(2);POP();RET()
# ======== ('CODE', 'ftell', code1)
def code1():
	label('ftell');
	_PROLOGUE(16,12,0x80); # save=R7
	LDW(R8);STW(R7);
	STW(R8);
	CALLI('_schkseek');
	_BNE('.11');
	MOVW(R7,R8);
	_MOVL('.13',L9);
	MOVQW(1,R11);
	LDXW(R7,2);ADDI(6);DEEK();CALL(vAC);
	
	_BRA('.10');
	label('.11');
	_MOVL('.14',LAC);
	label('.10');
	_EPILOGUE(16,12,0x80);
# ======== ('CODE', 'fseek', code2)
def code2():
	label('fseek');
	_PROLOGUE(20,10,0xf0); # save=R4-7
	MOVW(R8,R7);
	_MOVL(L9,L5);
	MOVW(R11,R4);
	MOVW(R7,R8);
	CALLI('_schkseek');
	_BNE('.18');
	MOVW(R7,R8);
	_MOVL(L5,L9);
	MOVW(R4,R11);
	LDXW(R7,2);ADDI(6);DEEK();CALL(vAC);
	LDWI('.13');_LCMPS();_BGE('.16');
	label('.18');
	LDWI(-1);
	_BRA('.15');
	label('.16');
	PEEKV(R7);ANDI(231);POKE(R7);
	LDI(0);
	label('.15');
	_EPILOGUE(20,10,0xf0,saveAC=True);
# ======== ('CODE', 'rewind', code3)
def code3():
	label('rewind');
	_PROLOGUE(16,12,0x80); # save=R7
	LDW(R8);STW(R7);
	STW(R8);
	_MOVL('.13',L9);
	MOVQW(0,R11);
	CALLI('fseek');
	PEEKV(R7);ANDI(243);POKE(R7);
	label('.19');
	_EPILOGUE(16,12,0x80);
# ======== ('DATA', '.14', code4, 0, 4)
def code4():
	align(4);
	label('.14');
	words(65535,65535); # -1
# ======== ('DATA', '.13', code5, 0, 4)
def code5():
	align(4);
	label('.13');
	words(0,0); # 0
# ======== (epilog)
code=[
	('CODE', '_schkseek', code0),
	('EXPORT', 'ftell'),
	('CODE', 'ftell', code1),
	('EXPORT', 'fseek'),
	('CODE', 'fseek', code2),
	('EXPORT', 'rewind'),
	('CODE', 'rewind', code3),
	('IMPORT', 'errno'),
	('DATA', '.14', code4, 0, 4),
	('DATA', '.13', code5, 0, 4) ]
module(code=code, name='../gigatron/libc/fseek.c', cpu=7);

# Local Variables:
# mode: python
# indent-tabs-mode: t
# End:
