#VCPUv5

# ======== ('CODE', '_sflags', code0)
def code0():
	label('_sflags');
	PUSH();
	LDW(R8);PEEK();STW(R17);
	XORI(114);_BEQ('.9');
	LDW(R17);_CMPIS(114);_BGT('.13');
	label('.12');
	LDW(R17);XORI(97);_BEQ('.11');
	_BRA('.6');
	label('.13');
	LDW(R17);XORI(119);_BEQ('.10');
	_BRA('.6');
	label('.9');
	LDI(1);STW(R18);
	_BRA('.15');
	label('.10');
	LDI(2);STW(R18);
	_BRA('.15');
	label('.11');
	LDI(10);STW(R18);
	_BRA('.15');
	label('.6');
	LDI(0);
	_BRA('.5');
	label('.14');
	LDW(R19);XORI(43);_BEQ('.19');
	LDW(R19);_CMPIS(43);_BLT('.17');
	label('.21');
	LDW(R19);XORI(98);_BEQ('.18');
	_BRA('.17');
	label('.19');
	LDI(3);STW(R18);
	_BRA('.18');
	label('.17');
	LDI(0);
	_BRA('.5');
	label('.18');
	label('.15');
	LDI(1);ADDW(R8);STW(R8);
	
	PEEK();
	STW(R19);
	_BNE('.14');
	LDW(R18);
	label('.5');
	tryhop(2);POP();RET()
# ======== ('CODE', 'freopen', code1)
def code1():
	label('freopen');
	_PROLOGUE(16,6,0xf0); # save=R4-7
	LDW(R8);STW(R7);
	LDW(R9);STW(R6);
	LDW(R10);STW(R5);
	LDW(R6);STW(R8);
	CALLI('_sflags');
	STW(R4);
	_BNE('.23');
	LDWI('errno');STW(R23);
	LDI(3);DOKE(R23);
	LDI(0);
	_BRA('.22');
	label('.23');
	LDW(R5);STW(R8);
	CALLI('_sclose');
	LDW(R4);POKE(R5);
	LDW(R5);STW(R8);
	LDW(R7);STW(R9);
	CALLI('_openf');
	_BLT('.25');
	LDW(R5);PEEK();ANDI(243);POKE(R5);
	LDW(R5);
	_BRA('.22');
	label('.25');
	LDI(0);POKE(R5);
	LDI(0);
	label('.22');
	_EPILOGUE(16,6,0xf0,saveAC=True);
# ======== ('CODE', 'fopen', code2)
def code2():
	label('fopen');
	_PROLOGUE(16,8,0xe0); # save=R5-7
	LDW(R8);STW(R7);
	LDW(R9);STW(R6);
	CALLI('_sfindiob');
	STW(R5);
	_BEQ('.28');
	LDW(R7);STW(R8);
	LDW(R6);STW(R9);
	LDW(R5);STW(R10);
	CALLI('freopen');
	
	_BRA('.27');
	label('.28');
	LDWI('errno');STW(R23);
	LDI(6);DOKE(R23);
	LDI(0);
	label('.27');
	_EPILOGUE(16,8,0xe0,saveAC=True);
# ======== (epilog)
code=[
	('CODE', '_sflags', code0),
	('EXPORT', 'freopen'),
	('CODE', 'freopen', code1),
	('EXPORT', 'fopen'),
	('CODE', 'fopen', code2),
	('IMPORT', '_sfindiob'),
	('IMPORT', '_sclose'),
	('IMPORT', '_openf'),
	('IMPORT', 'errno') ]
module(code=code, name='../gigatron/libc/fopen.c', cpu=5);

# Local Variables:
# mode: python
# indent-tabs-mode: t
# End:
